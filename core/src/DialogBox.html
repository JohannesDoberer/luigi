<script>
    import { onMount, afterUpdate, beforeUpdate, createEventDispatcher } from 'svelte';
    import UserSettings from './dialogboxviews/UserSettings.html'
    const dispatch = createEventDispatcher();
    let userSettingsData = [];
    let userSettingsCategory = [];
    let userSettings = {}
    const temp = []
    let displayEditor = false;
    const userSettingsSchema = {
        userSettingGroups: {
            userAccount: {
                label: 'User Account',
                sublabel: 'username',
                icon: 'icon.jpg',
                title: 'title',
                settings: {
                    name: { type: 'string', label: 'Name', isEditable: true, value: '' },
                    email: { type: 'string', label: 'E-Mail', isEditable: false, value: '' },
                    server: { type: 'string', label: 'Server', isEditable: false, value: '' }
                }
            },
            language: {
                label: 'Language & Region',
                sublabel: 'EN | Time Format: 12h',
                icon: false,
                title: 'Language & Region',
                settings: {
                    language: {
                        type: 'enum',
                        label: 'Language and Region',
                        options: ['German', 'English', 'Spanish', 'French'],
                        description: 'After you save your settings, the browser will refresh for the new language to take effect.'
                    },
                    date: { type: 'string', label: 'Date Format' },
                    time: { type: 'enum', label: 'Time Format', options: ['12 h', '24 h'] }
                }
            },
            privacy: {
                label: 'Privacy',
                title: 'Privacy',
                settings: {
                    policy: { type: 'string', label: 'Privacy policy has not been defined.' }
                }
            }
        }
    }

    const mockSavedSettings = {
        userSettingGroups: {
            userAccount: {
                label: 'User Account',
                sublabel: 'username',
                icon: 'icon.jpg',
                title: 'title',
                settings: {
                    name: { type: 'string', label: 'Name', isEditable: true, value: 'Luigi' },
                    email: { type: 'string', label: 'E-Mail', isEditable: false, value: 'luigi@luigi.de' },
                    server: { type: 'string', label: 'Server', isEditable: false, value: 'luigi.server' }
                }
            },
            language: {
                label: 'Language & Region',
                sublabel: 'EN | Time Format: 12h',
                icon: false,
                title: 'Language & Region',
                settings: {
                    language: {
                        type: 'enum',
                        label: 'Language and Region',
                        options: ['German', 'English', 'Spanish', 'French', 'Italian'],
                        description: 'After you save your settings, the browser will refresh for the new language to take effect.',
                        value: 'Italian'
                    },
                    date: { type: 'string', label: 'Date Format' },
                    time: { type: 'enum', label: 'Time Format', options: ['12 h', '24 h'], value='12 h' }
                }
            },
            privacy: {
                label: 'Privacy',
                title: 'Privacy',
                settings: {
                    policy: { type: 'string', label: 'Privacy policy has not been defined.' }
                }
            }
        }
    }

    function prepareLeftNavData() {
        let object = userSettingsSchema.userSettingGroups;
        for (const item in object) {
            userSettingsCategory.push(item);
            let innerObj = {};
            innerObj[item] = object[item];
            userSettingsData.push(innerObj);
        }
    }

    beforeUpdate(() => {
        prepareLeftNavData();
    });

    afterUpdate(() => { });

    onMount(() => { });

    function openView(category) {
        console.log('openView ', category);
        displayEditor = true;
        userSettings = category;
    }

</script>

<style>
    .dialog-size {
        width: 800px;
        height: 500px;
    }

    .dialog-leftnav {
        position: absolute;
        left: 0;
        height: 100%;
        width: 200px;
    }

    .iframeDialogCtn {
        overflow: auto;
        position: absolute;
        right: 0;
        float: left;
        height: 100%;
        width: 75%;
        overflow-wrap: break-word;
    }
</style>

<div class="fd-dialog fd-dialog--active">
    <div class="fd-dialog__content dialog-size">
        <header class="fd-dialog__header fd-bar fd-bar--header">
            <div class="fd-bar__left">
                <div class="fd-bar__element">
                    <h3 class="fd-dialog__title">User Settings</h3>
                </div>
            </div>
            <div class="fd-bar__right">
                <div class="fd-bar__element">
                    <h3 class="fd-dialog__title" on:click|preventDefault="{()=>dispatch('close')}">X</h3>
                </div>
            </div>
        </header>
        <div class="fd-dialog__body">
            <div class="dialog-leftnav">
                <div class="fd-side-nav">
                    <div class="fd-side-nav__main-navigation">
                        <div class="lui-fd-side-nav-wrapper">
                            <ul class="fd-nested-list">
                                <!-- {#each userSettingsCategory as category} -->
                                {#each Object.entries(userSettingsData) as [key,item], index}
                                    {#each Object.entries(item) as property}
                                        <li class="fd-nested-list__item">
                                            <a class="fd-nested-list__link" on:click="{() => openView(property)}">
                                                <span class="fd-nested-list__title">
                                                    {property[1].label}
                                                </span>
                                            </a>
                                        </li>
                                    {/each}
                                {/each}
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- {#each Object.entries(userSettingsData) as [key,item], index}
                    {#each Object.entries(item) as property}
                        <li on:click|preventDefault="{() => test(property)}">
                            {property[1].label}
                        </li>
                    {/each}
                {/each} -->
            </div>
            <div class="fd-page iframeDialogCtn">
                <!-- <iframe src="/sampleapp.html#/overview"></iframe> -->
                {#if displayEditor}
                    <UserSettings userSettingsGroup={userSettings}></UserSettings>
                {/}
            </div>
        </div>
        <footer class="fd-dialog__footer fd-bar fd-bar--footer">
            <div class="fd-bar__right">
                <div class="fd-bar__element">
                    <button
                        class="fd-dialog__decisive-button fd-button fd-button--emphasized fd-button--compact confirm-button">Save</button>
                </div>
                <div class="fd-bar__element">
                    <button
                        class="fd-dialog__decisive-button fd-button fd-button--transparent fd-button--compact">Dismiss</button>
                </div>
            </div>
        </footer>
    </div>
</div>